{% extends 'base/base.html' %} {% load crispy_forms_tags %} {% block content %}



<body>
  <div class="mt-3 mb-5" style="text-align: center;">
    <h1>Gestion de Servicios</h1>
  </div>
  <div class="row">
    <div class="col-9">
      <label for="">Buscar:</label>
      <div class="input-container my-3">

        <input
        class="form-control"
        type="text"
        id="miInput"
        onkeyup="buscarDatosTabla()"
        placeholder=" Ingrerse Nombre:"
        title="Escribe un nombre"
      />
      </div>


    </div>
    <div class="col-3">
      <!-- Basic dropdown -->
      <label for="">Ordenar Por:</label>
      <button
      style="padding: 9px 30px;"
        class="btn dropdown-toggle mr-4 my-3"
        type="button"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        Seleccione...
      </button>

      <div class="dropdown-menu">
        <a class="dropdown-item" href="#" onclick="ordenarTabla(0, 'int')"
          >Id</a
        >
        <a class="dropdown-item" href="#" onclick="ordenarTabla(1, 'str')"
          >Alfabeticamente</a
        >
        <a class="dropdown-item" href="#" onclick="ordenarTabla(2, 'int')"
          >Valor Servicio</a
        >
        <a class="dropdown-item" href="#" onclick="ordenarTabla(3, 'int')"
          >Estado Servicio</a
        >
      </div>
      <!-- Basic dropdown -->
    </div>
  </div>

  <table class="table" id="miTabla">
    <thead class="thead-dark">
      <tr>
        <th onclick="ordenarTabla(0, 'int')" scope="col">Id</th>
        <th onclick="ordenarTabla(1, 'str')" scope="col">Nombre Servicio</th>
        <th onclick="ordenarTabla(2, 'int')" scope="col">Valor Servicio</th>
        <th onclick="ordenarTabla(3, 'int')" scope="col">Estado Servicio</th>
        <th scope="col" style="width: 270px;">Acciones</th>
      </tr>
    </thead>

    <tbody>
      {% if servicios %} {% for servicio in servicios %}

      <tr>
        <td>{{servicio.id_servicio}}</td>
        <td>{{servicio.nombre_servicio}}</td>
        <td>{{servicio.valor_servicio}}</td>
        <td>{{servicio.id_estado_servicio}}</td>
        <td>
          <div class="row">
            <div class="col-6">
              <a
                href="{% url 'actualizar-servicio' servicio.id_servicio %}"
                class="btn warn"
                >Actualizar
              </a>
            </div>
            <div class="col-6">
              <a
                href="{% url 'eliminar-servicio' servicio.id_servicio %}"
                class="btn dang"
                >Eliminar
              </a>
            </div>
          </div>

        </td>
      </tr>

      {% endfor %} {% else %}
      <h1>No hay registros de servicios</h1>

      {% endif %}
    </tbody>
  </table>

  <div style="text-align: center;">
    <a href="/servicio/registrar/" class="btn">Nuevo Servicio</a>
  </div>
</body>

<script>
  function buscarDatosTabla() {
    var input, filter, table, tr, td, i, txtValue;
    input = document.getElementById("miInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("miTabla");
    tr = table.getElementsByTagName("tr");
    for (i = 0; i < tr.length; i++) {
      td = tr[i].getElementsByTagName("td")[1];
      if (td) {
        txtValue = td.textContent || td.innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }
    }
  }
</script>

<script>
  /**
    
     * Funcion para ordenar una tabla... tiene que recibir el numero de columna a
    
     * ordenar y el tipo de orden
    
     * @param int n
    
     * @param str type - ['str'|'int']
    
     */

  function ordenarTabla(n, type) {
    var table,
      rows,
      switching,
      i,
      x,
      y,
      shouldSwitch,
      dir,
      switchcount = 0;

    table = document.getElementById("miTabla");

    switching = true;

    //Enviando el orden de la tabla como ascendente:

    dir = "asc";

    /*crea un loop que finaliza cuando el switching esta completado:*/

    while (switching) {
      //comienza con valor del cabmio como false:

      switching = false;

      rows = table.rows;

      /*el loop recorre todas las columnas de la tabla (exceptuando la primera, ya que contiene el encabezado de la tabla):*/

      for (i = 1; i < rows.length - 1; i++) {
        //Comienza diciendo que no debe haber cambio:

        shouldSwitch = false;

        /*Se obtiene los 2 elementos que se quieren comparar, uno de la fila actual y otro de la siguiente:*/

        x = rows[i].getElementsByTagName("TD")[n];

        y = rows[i + 1].getElementsByTagName("TD")[n];

        /*    Comprueba si las dos filas deberian cambiar de lugar, basada en el tipo de orden, asc o desc:*/

        if (dir == "asc") {
          //para orden ascendente

          if (
            (type == "str" &&
              x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) ||
            (type == "int" && parseFloat(x.innerHTML) > parseFloat(y.innerHTML))
          ) {
            // si es asi, se marca como cambio y termina el ciclo (loop)

            shouldSwitch = true;

            break;
          }
        } else if (dir == "desc") {
          //para orden descendente

          if (
            (type == "str" &&
              x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) ||
            (type == "int" && parseFloat(x.innerHTML) < parseFloat(y.innerHTML))
          ) {
            // si es asi, se marca como cambio y termina el ciclo (loop)

            shouldSwitch = true;

            break;
          }
        }
      }

      if (shouldSwitch) {
        /*Si se marca un cambio, se realiza el cambio y se marca como completado:*/

        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);

        switching = true;

        //cada vez que se hace el cambio, el contador aumenta en 1:

        switchcount++;
      } else {
        /*Si no se ha realizado ningún cambio Y la dirección es "asc", se configura la dirección como "desc" y se ejecuta el ciclo  nuevamente.*/

        if (switchcount == 0 && dir == "asc") {
          dir = "desc";

          switching = true;
        }
      }
    }
  }
</script>

{% endblock %}
